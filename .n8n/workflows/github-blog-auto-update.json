{
  "name": "RSS to GitHub Blog Auto Update",
  "nodes": [
    {
      "parameters": {
        "url": "https://b.hatena.ne.jp/Buchi_6uclz1/rss",
        "options": {}
      },
      "id": "b5c39ec2-f419-4a57-9e7d-6d8126536c37",
      "name": "Read Hatena Bookmark RSS",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [
        960,
        -340
      ]
    },
    {
      "parameters": {},
      "id": "f2240cb8-8b05-4a8e-8323-6ca91055c907",
      "name": "Filter Yesterday's Articles",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1160,
        -340
      ]
    },
    {
      "parameters": {
        "functionCode": "// 元のRSSデータを保持しつつ、Gemini用のプロンプトを準備\nvar items = [];\n\nfor (var i = 0; i < $input.all().length; i++) {\n  var item = $input.all()[i].json;\n  \n  items.push({\n    json: {\n      // Gemini APIリクエスト用のデータ\n      title: item.title || '',\n      content: item.content || item.description || '',\n      link: item.link || '',\n      description: item.description || '',\n      // 元のデータを保持\n      originalData: {\n        title: item.title,\n        link: item.link,\n        description: item.description,\n        content: item.content,\n        pubDate: item.pubDate,\n        guid: item.guid\n      }\n    }\n  });\n}\n\nreturn items;"
      },
      "id": "647bfc1f-8c31-41b8-a87c-3e2bcb99f168",
      "name": "Prepare for Gemini",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1360,
        -340
      ]
    },
    {
      "parameters": {
        "resource": "file",
        "owner": {
          "__rl": true,
          "mode": "list",
          "value": "6uclz1"
        },
        "repository": {
          "__rl": true,
          "mode": "list",
          "value": "claude-code-blog-site"
        },
        "filePath": "={{ $json.path }}",
        "fileContent": "={{ $json.content }}",
        "commitMessage": "=新しい記事を追加: {{ $json.title }}"
      },
      "id": "d1d8d475-abd4-4c64-b80c-fff8415dd41d",
      "name": "Push to GitHub",
      "type": "n8n-nodes-base.github",
      "typeVersion": 1,
      "position": [
        2160,
        -340
      ],
      "webhookId": "0bf6c15d-4e74-48d9-99fa-0bf957f09d5b",
      "credentials": {
        "githubApi": {
          "id": "hmbM5H15296xQFgD",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        780,
        -340
      ],
      "id": "72d392c6-e7d5-4e0c-b2d6-97c62f833e13",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googlePalmApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [{\n      \"text\": \"以下の記事の内容を日本語で簡潔に要約してください（3-5文程度）:\\n\\nタイトル: {{ $json.title }}\\n\\n内容: {{ $json.content || $json.description }}\\n\\nURL: {{ $json.link }}\"\n    }]\n  }]\n}",
        "options": {}
      },
      "id": "ca38c10c-a6eb-40c7-acfb-e1b3d1df9617",
      "name": "Summarize with Gemini1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1580,
        -340
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "1HK7XWbk8HMs5R9f",
          "name": "Header Auth account"
        },
        "googlePalmApi": {
          "id": "XsmZZC4Hxt4IfWNx",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Geminiの応答から要約テキストを抽出し、元のデータと組み合わせ\nvar items = [];\n\n\nfor (var i = 0; i < $input.all().length; i++) {\n  var prepareGeminiData = $('Prepare for Gemini').itemMatching(i);\n  var geminiResponse = $input.all()[i].json;\n  \n  // Geminiの要約テキストを取得\n  var summary = '';\n  if (geminiResponse.candidates && geminiResponse.candidates.length > 0) {\n    var content = geminiResponse.candidates[0].content;\n    if (content && content.parts && content.parts.length > 0) {\n      summary = content.parts[0].text || '';\n    }\n  }\n  \n  // 元のRSSデータから必要な情報を取得\n  var title = prepareGeminiData.json.title || 'Untitled';\n  var link = prepareGeminiData.json.link || '#';\n  var description = prepareGeminiData.json.description || '';\n  \n  items.push({\n    json: {\n      title: title,\n      link: link,\n      summary: summary.trim(),\n      content: summary.trim(),\n      description: description,\n      // originalData: prepareGeminiData\n    }\n  });\n}\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1780,
        -340
      ],
      "id": "20d3af34-0566-4fb1-af33-16fd4c023963",
      "name": "Code"
    },
    {
      "parameters": {
        "jsCode": "// 現在の日付を取得\nvar now = new Date();\nvar year = now.getFullYear();\nvar month = (now.getMonth() + 1).toString();\nif (month.length === 1) month = '0' + month;\nvar day = now.getDate().toString();\nif (day.length === 1) day = '0' + day;\nvar dateString = year + '-' + month + '-' + day;\n\n// 複数の記事を処理\nvar allInputs = $input.all();\nvar articles = [];\nvar summaries = [];\n\nfor (var i = 0; i < allInputs.length; i++) {\n  var inputData = allInputs[i].json;\n  \n  if (inputData.summary) {\n    articles.push({\n      title: inputData.title,\n      link: inputData.link,\n      summary: inputData.summary,\n    });\n    summaries.push(inputData.summary);\n  }\n}\n\n\n\n// 記事がない場合のフォールバック\nif (articles.length === 0) {\n}\n\n// マークダウンコンテンツを生成\nvar markdownContent = '---\\n' +\n  'layout: post\\n' +\n  'title: \"' + dateString + '\"\\n' +\n  'date: ' + dateString + '\\n' +\n  'excerpt: \"' + articles.map((row) => row.title) + '\"\\n' +\n  '---\\n\\n';\n\n// 各記事を追加\nfor (var j = 0; j < articles.length; j++) {\n  var article = articles[j];\n  markdownContent += '## ' + (j + 1) + '. ' + article.title + '\\n\\n';\n  markdownContent += article.summary + '\\n\\n';\n  markdownContent += 'source: ' + article.link + '\\n\\n';\n}\n\n// ファイル名を生成\nvar filename = dateString + '-summary' + '.md';\n\nreturn {\n  json: {\n    filename: filename,\n    content: markdownContent,\n    path: '_posts/' + filename,\n    title: dateString,\n    date: dateString,\n    articleCount: articles.length\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1980,
        -340
      ],
      "id": "7005325c-14ce-4cb0-91b1-35c0edcd07ad",
      "name": "Code1"
    }
  ],
  "pinData": {},
  "connections": {
    "Read Hatena Bookmark RSS": {
      "main": [
        [
          {
            "node": "Filter Yesterday's Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Yesterday's Articles": {
      "main": [
        [
          {
            "node": "Prepare for Gemini",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Gemini": {
      "main": [
        [
          {
            "node": "Summarize with Gemini1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Read Hatena Bookmark RSS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize with Gemini1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Push to GitHub",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ec324c86-f767-4879-84dd-af8462d3a56d",
  "meta": {
    "instanceId": "ee82d7e718c4a5cacbf50c2808a7d6a8ae0672c8e3892c73a0147a51ef2f6749"
  },
  "id": "0PRHnBrWKueF4gzk",
  "tags": []
}